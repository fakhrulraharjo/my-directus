"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},e=(0).constructor;e.isFinite,e.isInteger,[].constructor.isArray;function n(t,e){if("__proto__"!==t)return e}function r(t){return"string"==typeof t?(e=t,String(e).includes("__proto__")?JSON.parse(e,n):JSON.parse(e)):t;var e}new(function(){function t(t){this.size=t,this.reset()}return t.prototype.reset=function(){this.oldestIndex=0,this.map={},this.cachedKeys=new Array(this.size)},t.prototype.get=function(t){return this.map[t]},t.prototype.set=function(t,e){this.map[t]=e;var n=this.cachedKeys[this.oldestIndex];void 0!==n&&delete this.map[n],this.cachedKeys[this.oldestIndex]=t,this.oldestIndex++,this.oldestIndex%=this.size},t}())(1e3);var o={};!function(e,n){(function(){function t(t){return t[(e=0,n=t.length-1,Math.floor(Math.random()*(n-e+1))+e)];var e,n}function n(t){return{numbers:"0123456789",alphabetic:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",alphanumeric:"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"}[t]}function r(t){t=t||{},this.count=t.count||1,this.length=t.length||8,this.charset=t.charset||n("alphanumeric"),this.unique_charset=function(t){for(var e={},n=[],r=0;r<t.length;r++){const o=t[r];e[o]||(n.push(o),e[o]=!0)}return n.join("")}(this.charset),this.prefix=t.prefix||"",this.postfix=t.postfix||"",this.pattern=t.pattern||function(t,e){for(var n="",r=0;r<e;r++)n+=t;return n}("#",this.length),t.pattern&&(this.length=(t.pattern.match(/#/g)||[]).length)}function o(e,n){var r=0,o=e.pattern.split("").map((function(o){return"#"===o?isNaN(n)?t(e.charset):function(t,e,n){return t.unique_charset[Math.floor(e/Math.pow(t.unique_charset.length,t.length-n-1))%t.unique_charset.length]}(e,n,r++):o})).join("");return e.prefix+o+e.postfix}function i(t){return Math.pow(t.unique_charset.length,t.length)}var s={generate:function(t,e){var n=(t=new r(t)).count;if(!function(t){return i(t)>=t.count}(t))throw new Error("Not possible to generate requested number of codes.");e=+e,isNaN(e)||(e<0?e=0:e>=i(t)&&(e=i(t)-1));for(var s={},a=[];n>0;){var c=o(t,e);s[c]||(a.push(c),s[c]=!0,n--),e++}return a},charset:n};e.exports&&(e.exports=s)}).call(t)}({get exports(){return o},set exports(t){o=t}});var i=o;const s="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";var a={id:"generate_uid",handler:async({collection:t,payload:e},{accountability:n,database:o,getSchema:a,services:c})=>{var u,h;const{ItemsService:l}=c,f=new l(t,{schema:await a({database:o}),accountability:n,knex:o});let p;const d=null!=(u=r(e))?u:null,g=(t=>{var e={...t};for(const t in e)void 0!==e[t]&&"undefined"!=e[t]||delete e[t];return e})(null!=(h=r(null==d?void 0:d.item))?h:null);if(!d)throw Error("No Payload");if(!d.count)throw Error("No Count parameter");if(!d.item)throw Error("No item parameter");let m="number"==typeof d.dash?d.dash:2,v=d.length?d.length:8;const w=(t=>{switch(t){case"numbers":return"1234567890";case"alphabetic":return"ABCDEFGHIJKLMNOPQRSTUVWXYZ";default:return s}})(d.charset);try{let t=await(y=v,x=m,b=d.prefix,N=d.postfix,console.log("lentgh %d",y),new Promise(((t,e)=>{var n="";const r=x+1%y;var o=0;b||e(new Error("Undefined prefix"));for(let t=0;t<y;t++,o++)b&&b[t]?n+=b[t]:n+="#",x>0&&o==r&&t!=y-1&&(n+="-",o=0);N&&(n+=N),t(n)})));const e=((t,e={})=>d&&d.item?t.map((t=>{const n={...e,[d.column||"id"]:t};return console.log("second :",d.column),console.log("second :",n),n})):null)(i.generate({count:d.count,pattern:t,charset:w}),g);if(!e)throw Error("No item to be created");return p=await f.createMany(e),[m,d.dash]}catch(t){throw t}var y,x,b,N}};module.exports=a;
